# CONSTANTS
variable zero_lvl equal "-0.0184635"
variable carbon_speed_down equal "-231"
variable input_file_path "fall_s.input.data"

# INIT
units       metal
dimension   3
boundary    p p f
atom_style  atomic
atom_modify map yes
read_data   v_input_file_path

# GROUPS
group   g_fu type 2
group   g_si_all type 1
lattice diamond 5.43 orient x 1 0 0 orient y 0 1 0 orient z 0 0 1
region  r_si_center block -11 11 -11 11 -34 0 units lattice
group   g_si_center region r_si_center
group   g_si_thermostat subtract g_si_all g_si_center
group   g_output id 1

# POTENTIAL
pair_style  hybrid airebo 3.0 tersoff/zbl
pair_coeff  * * tersoff/zbl SiC.tersoff.zbl Si C
pair_coeff  2 2 none
pair_coeff  * * airebo CH.airebo NULL C
neighbor    3.0 bin

# COMPUTES
compute   vOcu g_si_all voronoi/atom occupation only_group

variable  vVacTemp atom "c_vOcu[1]==0"
compute   vVacTemp g_si_all reduce sum v_vVacTemp
variable  vVac atom "c_vVacTemp"

variable  vIntTemp1 atom "c_vOcu[1]*(c_vOcu[1]>1)"
variable  vIntTemp2 atom "c_vOcu[1]>1"
variable  vIntTemp3 atom "v_vIntTemp1-v_vIntTemp2"
compute   vIntTemp3 g_si_all reduce sum v_vIntTemp3
variable  vInt atom "c_vIntTemp3"

# THERMO
reset_timestep 0
timestep       0.001
thermo         20
thermo_style   custom step ke
thermo_modify  lost ignore

# FIX
fix f_1 all nve
fix f_2 g_si_thermostat nvt temp 1e-3 1e-3 $(100.0*dt)

# DUMP
dump  d_vor g_output custom 20 vor_time.dump v_vVac v_vInt
dump  d_all all custom 20 all.dump id type x y z

# VELOCITY FU
velocity  g_fu set NULL NULL v_carbon_speed_down sum yes units box

# RUN
run 50

# LAST 10 STEPS COMPUTES
variable  c60_z atom "z-v_zero_lvl"

# LAST 10 STEPS DUMPS
undump  d_vor
dump    d_c60_z g_fu custom 5 c60_z.dump v_c60_z

# RUN LAST 10
run 50

# WRITE DATA
write_data  fall.output.data
